var __extends=this&&this.__extends||function(e,r){function t(){this.constructor=e}for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)},webcrypto;!function(e){var r;!function(e){function r(){var r,t={name:"",version:""},n=window.navigator.userAgent;return(r=/edge\/([\d\.]+)/i.exec(n))?(t.name=e.Browser.Edge,t.version=r[1]):/msie/i.test(n)?(t.name=e.Browser.IE,t.version=/msie ([\d\.]+)/i.exec(n)[1]):/chrome/i.test(n)?(t.name=e.Browser.Chrome,t.version=/chrome\/([\d\.]+)/i.exec(n)[1]):/safari/i.test(n)?(t.name=e.Browser.Safari,t.version=/([\d\.]+) safari/i.exec(n)[1]):/firefox/i.test(n)&&(t.name=e.Browser.Firefox,t.version=/firefox\/([\d\.]+)/i.exec(n)[1]),t}function t(e){for(var r=new Uint8Array(e.length),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}function n(e){for(var r="",t=0;t<e.length;t++)r+=String.fromCharCode(e[t]);return r}function o(){for(var e=[],r=0;r<arguments.length;r++)e[r-0]=arguments[r];var t=new Uint8Array(e.map(function(e){return e.length}).reduce(function(e,r){return e+r})),n=0;return e.forEach(function(e){for(var r=0;r<e.length;r++)t[n+r]=e[r];n+=e.length}),t}e.Browser={IE:"Internet Explorer",Safari:"Safari",Edge:"Edge",Chrome:"Chrome",Firefox:"Firefox Mozilla"},e.BrowserInfo=r,e.string2buffer=t,e.buffer2string=n,e.concat=o}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(e){var r=function(){function e(){}return e}();e.CryptoKey=r}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(r){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.digest=function(t,n){return new Promise(function(o){if("undefined"==typeof asmCrypto)throw new r.LinerError(r.LinerError.MODULE_NOT_FOUND,"asmCrypto","https://github.com/vibornoff/asmcrypto.js");switch(t.name.toUpperCase()){case e.AlgorithmNames.Sha1:o(asmCrypto.SHA1.bytes(n).buffer);break;case e.AlgorithmNames.Sha256:o(asmCrypto.SHA256.bytes(n).buffer);break;default:throw new r.LinerError("Not supported algorithm '"+t.name+"'")}})},n}(e.BaseCrypto);t.ShaCrypto=n}(t=r.sha||(r.sha={}))}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(r){var t;!function(t){var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.checkModule=function(){if("undefined"==typeof asmCrypto)throw new r.LinerError(r.LinerError.MODULE_NOT_FOUND,"asmCrypto","https://github.com/vibornoff/asmcrypto.js")},n.generateKey=function(e,t,n){var o=this;return new Promise(function(a){o.checkModule();var i=r.nativeCrypto.getRandomValues(new Uint8Array(e.length/8)),s=new r.CryptoKey;s.key=i,s.algorithm=e,s.extractable=t,s.type="secret",s.usages=n,a(s)})},n.encrypt=function(r,t,n){return new Promise(function(o){var a;switch(r.name.toUpperCase()){case e.AlgorithmNames.AesCBC:var i=r;a=asmCrypto.AES_CBC.encrypt(n,t.key,void 0,i.iv);break;case e.AlgorithmNames.AesGCM:var s=r;a=asmCrypto.AES_GCM.encrypt(n,t.key,s.iv,s.additionalData,s.tagLength/8)}o(a.buffer)})},n.decrypt=function(r,t,n){return new Promise(function(o){var a;switch(r.name.toUpperCase()){case e.AlgorithmNames.AesCBC:var i=r;a=asmCrypto.AES_CBC.decrypt(n,t.key,void 0,i.iv);break;case e.AlgorithmNames.AesGCM:var s=r;a=asmCrypto.AES_GCM.decrypt(n,t.key,s.iv,s.additionalData,s.tagLength/8)}o(a.buffer)})},n.wrapKey=function(e,t,n,o){return new Promise(function(a,i){window.crypto.subtle.exportKey(e,t).then(function(e){var t;return t=e instanceof ArrayBuffer?new Uint8Array(e):r.string2buffer(JSON.stringify(e)),window.crypto.subtle.encrypt(o,n,t)}).then(a,i)})},n.unwrapKey=function(e,t,n,o,a,i,s){return new Promise(function(c,u){window.crypto.subtle.decrypt(o,n,t).then(function(t){var n;return"jwk"===e.toLowerCase()&&(n=JSON.parse(r.buffer2string(new Uint8Array(t)))),window.crypto.subtle.importKey(e,n,a,i,s)}).then(c,u)})},n.exportKey=function(r,t){return new Promise(function(n){var o=t.key;if("jwk"===r.toLowerCase()){var a={alg:"A"+t.algorithm.length+/-(\w+)/i.exec(t.algorithm.name.toUpperCase())[1],ext:t.extractable,k:e.Base64Url.encode(o),key_ops:t.usages,kty:"oct"};n(a)}else n(o.buffer)})},n.importKey=function(t,n,o,a,i){return new Promise(function(a){var s;if("jwk"===t.toLowerCase()){var c=n;s=e.Base64Url.decode(c.k)}else s=new Uint8Array(n);var u=new r.CryptoKey;u.algorithm=o,u.type="secret",u.usages=i,u.key=s,a(u)})},n}(e.BaseCrypto);t.AesCrypto=n}(t=r.aes||(r.aes={}))}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(r){var t;!function(t){function n(e){for(var r=new Uint8Array(e),t=[],n=0;n<r.length;n++)t.push(r[n]);return t}function o(e){for(var r=new Uint8Array(e.length/2),t=0;t<e.length;t++)r[t/2]=parseInt(e.slice(t,++t),16);return r}var a=function(t){function a(){t.apply(this,arguments)}return __extends(a,t),a.checkModule=function(){if("undefined"==typeof elliptic)throw new r.LinerError(r.LinerError.MODULE_NOT_FOUND,"elliptic","https://github.com/indutny/elliptic")},a.generateKey=function(t,n){var o=this;return new Promise(function(a){o.checkModule();var i=t,s=new elliptic.ec(i.namedCurve.replace("-","").toLowerCase()),c=new r.CryptoKey,u=new r.CryptoKey;c.key=u.key=s.genKeyPair(),c.algorithm=u.algorithm=i,c.extractable=u.extractable=n,c.type="private",u.type="public",t.name===e.AlgorithmNames.EcDSA?(c.usages=["sign"],u.usages=["verify"]):t.name===e.AlgorithmNames.EcDH&&(c.usages=u.usages=["deriveKey","deriveBits"]),a({privateKey:c,publicKey:u})})},a.sign=function(e,r,t){return new Promise(function(o,a){var i=e;crypto.subtle.digest(i.hash,t).then(function(){var e=n(t),a=r.key.sign(e);o(new Uint8Array(a.toDER()).buffer)})["catch"](a)})},a.verify=function(e,r,t,n){return new Promise(function(e){e(r.key.verify(n,t))})},a.deriveKey=function(e,t,n,o,a){var i=this;return new Promise(function(s,c){var u=Promise.resolve(null);if(!t.key){if(!t.extractable)throw new r.LinerError("'baseKey' is Native CryptoKey. It can't be converted to JS CryptoKey");u=u.then(function(){return crypto.subtle.exportKey("jwk",t)}).then(function(e){return i.importKey("jwk",e,t.algorithm,!0,t.usages)})}u.then(function(r){return r&&(t=r),i.deriveBits(e,t,n.length)}).then(function(e){return crypto.subtle.importKey("raw",new Uint8Array(e),n,o,a)}).then(s,c)})},a.deriveBits=function(e,r,t){var n=this;return new Promise(function(o,a){var i=Promise.resolve(null);e["public"].key||(i=i.then(function(){return crypto.subtle.exportKey("jwk",e["public"])}).then(function(e){return n.importKey("jwk",e,r.algorithm,!0,r.usages)})),i.then(function(n){n&&(e["public"]=n);var o=r.key.derive(e["public"].key.getPublic()),a=new Uint8Array(o.toArray().slice(0,t/8)).buffer;return Promise.resolve(a)}).then(o,a)})},a.exportKey=function(t,n){return new Promise(function(a){var i=n.key;if("jwk"!==t.toLowerCase())throw new r.LinerError("Format '"+t+"' is not implemented");var s=i.getPublic("hex").slice(2),c=s.slice(0,s.length/2),u=s.slice(s.length/2,s.length);if("public"===n.type){var p={crv:n.algorithm.namedCurve,ext:n.extractable,x:e.Base64Url.encode(o(c)),y:e.Base64Url.encode(o(u)),key_ops:n.usages,kty:"EC"};a(p)}else{var p={crv:n.algorithm.namedCurve,ext:n.extractable,d:e.Base64Url.encode(o(i.getPrivate("hex"))),x:e.Base64Url.encode(o(c)),y:e.Base64Url.encode(o(u)),key_ops:n.usages,kty:"EC"};a(p)}})},a.importKey=function(t,n,o,a,i){return new Promise(function(s){var c=new r.CryptoKey;if(c.algorithm=o,"jwk"!==t.toLowerCase())throw new r.LinerError("Format '"+t+"' is not implemented");var u=new elliptic.ec(n.crv.replace("-","").toLowerCase());n.d?(c.key=u.keyFromPrivate(e.Base64Url.decode(n.d)),c.type="private"):(c.key=u.keyFromPublic(r.concat(new Uint8Array([4]),e.Base64Url.decode(n.x),e.Base64Url.decode(n.y))),c.type="public"),c.extractable=a,c.usages=i,s(c)})},a}(e.BaseCrypto);t.EcCrypto=a}(t=r.ec||(r.ec={}))}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(r){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.generateKey=function(n,o,a){var i,s=arguments;return t.prototype.generateKey.apply(this,s).then(function(){return i=e.PrepareAlgorithm(n),r.nativeSubtle.generateKey.apply(r.nativeSubtle,s)["catch"](function(e){console.warn("WebCrypto: native generateKey for "+i.name+" doesn't work.",e.message||"")})}).then(function(t){if(t){if("keyUsage"in t||t.privateKey&&"keyUsage"in t){var n=t;n.privateKey||(n.usages=a)}return new Promise(function(e){return e(t)})}var s=null;switch(i.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():s=r.aes.AesCrypto;break;case e.AlgorithmNames.EcDSA.toLowerCase():case e.AlgorithmNames.EcDH.toLowerCase():s=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"generateKey")}return s.generateKey(i,o,a)})},n.prototype.digest=function(n,o){var a,i,s=arguments;return t.prototype.digest.apply(this,s).then(function(){return a=e.PrepareAlgorithm(n),i=e.PrepareData(o,"data"),r.nativeSubtle.digest.apply(r.nativeSubtle,s)["catch"](function(e){console.warn("WebCrypto: native digest for "+a.name+" doesn't work.",e.message||"")})}).then(function(e){return e?new Promise(function(r){return r(e)}):r.sha.ShaCrypto.digest(a,i)})},n.prototype.sign=function(n,o,a){var i,s,c=arguments;return t.prototype.sign.apply(this,c).then(function(){return i=e.PrepareAlgorithm(n),s=e.PrepareData(a,"data"),r.nativeSubtle.sign.apply(r.nativeSubtle,c)["catch"](function(e){console.warn("WebCrypto: native sign for "+i.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var n;switch(i.name.toLowerCase()){case e.AlgorithmNames.EcDSA.toLowerCase():n=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"sign")}return n.sign(i,o,s)})},n.prototype.deriveBits=function(n,o,a){var i,s=arguments;return t.prototype.deriveBits.apply(this,s).then(function(){i=e.PrepareAlgorithm(n);try{return r.nativeSubtle.deriveBits.apply(r.nativeSubtle,s)["catch"](function(e){console.warn("WebCrypto: native deriveBits for "+i.name+" doesn't work.",e.message||"")})}catch(t){console.warn("WebCrypto: native deriveBits for "+i.name+" doesn't work.",t.message||"")}}).then(function(t){if(t)return new Promise(function(e){return e(t)});var n;switch(i.name.toLowerCase()){case e.AlgorithmNames.EcDH.toLowerCase():n=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"deriveBits")}return n.deriveBits(i,o,a)})},n.prototype.deriveKey=function(n,o,a,i,s){var c,u,p=arguments;return t.prototype.deriveKey.apply(this,p).then(function(){c=e.PrepareAlgorithm(n),u=e.PrepareAlgorithm(a);try{return r.nativeSubtle.deriveKey.apply(r.nativeSubtle,p)["catch"](function(e){console.warn("WebCrypto: native deriveKey for "+c.name+" doesn't work.",e.message||"")})}catch(t){console.warn("WebCrypto: native deriveKey for "+c.name+" doesn't work.",t.message||"")}}).then(function(t){if(t)return new Promise(function(e){return e(t)});var n;switch(c.name.toLowerCase()){case e.AlgorithmNames.EcDH.toLowerCase():n=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"deriveBits")}return n.deriveKey(c,o,u,i,s)})},n.prototype.encrypt=function(n,o,a){var i,s,c=arguments;return t.prototype.encrypt.apply(this,c).then(function(){return i=e.PrepareAlgorithm(n),s=e.PrepareData(a,"data"),r.nativeSubtle.encrypt.apply(r.nativeSubtle,c)["catch"](function(e){console.warn("WebCrypto: native 'encrypt' for "+i.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var n;switch(i.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():n=r.aes.AesCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"encrypt")}return n.encrypt(i,o,s)})},n.prototype.decrypt=function(n,o,a){var i,s,c=arguments;return t.prototype.decrypt.apply(this,c).then(function(){return i=e.PrepareAlgorithm(n),s=e.PrepareData(a,"data"),r.nativeSubtle.decrypt.apply(r.nativeSubtle,c)["catch"](function(e){console.warn("WebCrypto: native 'decrypt' for "+i.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var n;switch(i.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():n=r.aes.AesCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"encrypt")}return n.decrypt(i,o,s)})},n.prototype.wrapKey=function(n,o,a,i){var s,c=arguments;return t.prototype.wrapKey.apply(this,c).then(function(){return s=e.PrepareAlgorithm(i),r.nativeSubtle.wrapKey.apply(r.nativeSubtle,c)["catch"](function(e){console.warn("WebCrypto: native 'wrapKey' for "+s.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var i;switch(s.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():i=r.aes.AesCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"wrapKey")}return i.wrapKey(n,o,a,s)})},n.prototype.unwrapKey=function(n,o,a,i,s,c,u){var p,y,l,f=arguments;return t.prototype.unwrapKey.apply(this,f).then(function(){return p=e.PrepareAlgorithm(i),y=e.PrepareAlgorithm(s),l=e.PrepareData(o,"wrappedKey"),r.nativeSubtle.unwrapKey.apply(r.nativeSubtle,f)["catch"](function(e){console.warn("WebCrypto: native 'unwrapKey' for "+p.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var o;switch(p.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():o=r.aes.AesCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"unwrapKey")}return o.unwrapKey(n,l,a,p,y,c,u)})},n.prototype.exportKey=function(n,o){var a=arguments;return t.prototype.exportKey.apply(this,a).then(function(){return r.nativeSubtle.exportKey.apply(r.nativeSubtle,a)["catch"](function(e){console.warn("WebCrypto: native 'exportKey' for "+o.algorithm.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var a;switch(o.algorithm.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():a=r.aes.AesCrypto;break;case e.AlgorithmNames.EcDH.toLowerCase():case e.AlgorithmNames.EcDSA.toLowerCase():a=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"exportKey")}return a.exportKey(n,o)})},n.prototype.importKey=function(n,o,a,i,s){var c,u,p=arguments;return t.prototype.importKey.apply(this,p).then(function(){return c=e.PrepareAlgorithm(a),u=o,ArrayBuffer.isView(o)&&(u=e.PrepareData(o,"keyData")),r.nativeSubtle.importKey.apply(r.nativeSubtle,p)["catch"](function(e){console.warn("WebCrypto: native 'importKey' for "+c.name+" doesn't work.",e.message||"")})}).then(function(t){if(t)return new Promise(function(e){return e(t)});var o;switch(c.name.toLowerCase()){case e.AlgorithmNames.AesCBC.toLowerCase():case e.AlgorithmNames.AesGCM.toLowerCase():o=r.aes.AesCrypto;break;case e.AlgorithmNames.EcDH.toLowerCase():case e.AlgorithmNames.EcDSA.toLowerCase():o=r.ec.EcCrypto;break;default:throw new r.LinerError(r.LinerError.NOT_SUPPORTED,"importKey")}return o.importKey(n,u,c,i,s)})},n}(e.Subtle);r.CryptoSubtle=t}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(r){var t=function(e){function r(){e.apply(this,arguments),this.code=10}return __extends(r,e),r.MODULE_NOT_FOUND="Module '%1' is not found. Download it from %2.\nOnly hash algorithms supported by the user agent will be supported.",r}(e.WebCryptoError);r.LinerError=t;var n=function(){function e(){this.subtle=new r.CryptoSubtle,this.getRandomValues=r.nativeCrypto.getRandomValues}return e}();r.Crypto=n}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));var webcrypto;!function(e){var r;!function(e){function r(e,r){var t=e[r];e[r]=function(){var n=arguments;return new Promise(function(o,a){var i=t.apply(e,n);i.oncomplete=function(e){console.log("Complited"),o(e.target.result)},i.onerror=function(){console.log("Error"),a("Error on running '"+r+"' function")}})}}var t=window;if(e.nativeCrypto=t.crypto||t.msCrypto,e.nativeSubtle=e.nativeCrypto.subtle||e.nativeCrypto.webkitSubtle,e.browser=e.BrowserInfo(),t.msCrypto){if(!t.Promise)throw new e.LinerError(e.LinerError.MODULE_NOT_FOUND,"Promise","https://www.promisejs.org");r(e.nativeSubtle,"generateKey"),r(e.nativeSubtle,"digest"),r(e.nativeSubtle,"sign"),r(e.nativeSubtle,"verify"),r(e.nativeSubtle,"encrypt"),r(e.nativeSubtle,"decrypt"),r(e.nativeSubtle,"importKey"),r(e.nativeSubtle,"exportKey"),r(e.nativeSubtle,"wrapKey"),r(e.nativeSubtle,"unwrapKey"),r(e.nativeSubtle,"deriveKey"),r(e.nativeSubtle,"deriveBits")}delete window.crypto,t.crypto=new e.Crypto}(r=e.liner||(e.liner={}))}(webcrypto||(webcrypto={}));